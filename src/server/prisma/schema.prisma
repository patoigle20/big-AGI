generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LinkStorageDataType {
  CHAT_V1
  // Si tienes otros tipos, ponlos también.
}

model TradeLink {
  id         String              @id @default(uuid())
  dataType   LinkStorageDataType
  createdAt  DateTime            @default(now())
  ownerId    String
}

/// Models for chat sync
model User {
  id        String         @id @default(uuid())
  email     String?        @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime      @updatedAt

  // relación con Conversation (asegúrate de que Conversation tenga ownerId y owner)
  conversations Conversation[]
}



model Conversation {
  id              String      @id
  ownerId         String
  owner           User        @relation(fields: [ownerId], references: [id])
  title           String?
  systemPurposeId String
  createdAt       DateTime
  updatedAt       DateTime
  version         Int         @default(1)
  isIncognito     Boolean     @default(false)

  messages Message[]

  @@index([ownerId])
}

model Message {
  id             String       @id
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  role           String
  text           String?
  fragmentsJson  String?
  createdAt      DateTime
  updatedAt      DateTime?
  isDeleted      Boolean      @default(false)
  metaJson       String?

  @@index([conversationId])
}
